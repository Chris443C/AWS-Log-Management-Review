<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Log Management Review - PCI DSS Compliance Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #0073aa;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #0073aa;
            margin: 0;
            font-size: 2.5em;
        }
        .header .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-top: 10px;
        }
        .executive-summary {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .executive-summary h2 {
            color: #0073aa;
            margin-top: 0;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .summary-item {
            text-align: center;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            border-left: 4px solid #0073aa;
        }
        .summary-item .number {
            font-size: 2em;
            font-weight: bold;
            color: #0073aa;
        }
        .summary-item .label {
            color: #666;
            margin-top: 5px;
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            color: #0073aa;
            border-bottom: 2px solid #0073aa;
            padding-bottom: 10px;
        }
        .findings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .findings-table th,
        .findings-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .findings-table th {
            background-color: #0073aa;
            color: white;
            font-weight: bold;
        }
        .findings-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .severity-high {
            background-color: #ffebee;
            color: #c62828;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        .severity-medium {
            background-color: #fff3e0;
            color: #ef6c00;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        .severity-low {
            background-color: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .recommendation-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .recommendation-card h3 {
            color: #0073aa;
            margin-top: 0;
        }
        .priority-high {
            border-left: 4px solid #c62828;
        }
        .priority-medium {
            border-left: 4px solid #ef6c00;
        }
        .priority-low {
            border-left: 4px solid #2e7d32;
        }
        .compliance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .compliance-table th,
        .compliance-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .compliance-table th {
            background-color: #0073aa;
            color: white;
            font-weight: bold;
        }
        .status-compliant {
            color: #2e7d32;
            font-weight: bold;
        }
        .status-non-compliant {
            color: #c62828;
            font-weight: bold;
        }
        .cost-optimization {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .cost-optimization h3 {
            color: #1976d2;
            margin-top: 0;
        }
        .cost-optimization ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
        }
        .script-section {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .script-section h3 {
            color: #0073aa;
            margin-top: 0;
        }
        .script-list {
            list-style: none;
            padding: 0;
        }
        .script-list li {
            padding: 10px;
            background-color: white;
            margin-bottom: 10px;
            border-radius: 3px;
            border-left: 4px solid #0073aa;
        }
        .script-list li strong {
            color: #0073aa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AWS Log Management Review</h1>
            <div class="subtitle">PCI DSS Compliance Assessment Report</div>
            <div style="margin-top: 10px; color: #666;">
                Generated on {{ timestamp }}
            </div>
        </div>

        <div class="executive-summary">
            <h2>Executive Summary</h2>
            <p>This report presents the findings of a comprehensive review of AWS log management practices 
            in relation to PCI DSS v4.0.1 compliance requirements, specifically focusing on Requirement 10 
            (Logging and Monitoring). The analysis covers CloudTrail, S3 access logging, CloudWatch Logs, 
            RDS logging, and IAM monitoring configurations.</p>
            
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="number">{{ total_issues }}</div>
                    <div class="label">Issues Found</div>
                </div>
                <div class="summary-item">
                    <div class="number">{{ total_recommendations }}</div>
                    <div class="label">Recommendations</div>
                </div>
                <div class="summary-item">
                    <div class="number">{{ compliance_score }}%</div>
                    <div class="label">Compliance Score</div>
                </div>
                <div class="summary-item">
                    <div class="number">{{ estimated_cost }}</div>
                    <div class="label">Estimated Monthly Cost</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Findings Summary</h2>
            
            <h3>CloudTrail Configuration</h3>
            <ul>
                <li><strong>Status:</strong> {{ "Enabled" if cloudtrail.enabled else "Not Enabled" }}</li>
                {% if cloudtrail.enabled %}
                <li><strong>Multi-Region:</strong> {{ "Yes" if cloudtrail.multi_region else "No" }}</li>
                <li><strong>Log File Validation:</strong> {{ "Enabled" if cloudtrail.log_file_validation else "Disabled" }}</li>
                {% endif %}
            </ul>

            <h3>S3 Access Logging</h3>
            <ul>
                <li><strong>Buckets Analyzed:</strong> {{ s3_logging.buckets_analyzed }}</li>
                <li><strong>Buckets with Logging:</strong> {{ s3_logging.buckets_with_logging }}</li>
                <li><strong>Buckets without Logging:</strong> {{ s3_logging.buckets_analyzed - s3_logging.buckets_with_logging }}</li>
            </ul>

            <h3>CloudWatch Logs</h3>
            <ul>
                <li><strong>Log Groups Analyzed:</strong> {{ cloudwatch_logs.log_groups }}</li>
                <li><strong>Log Groups with Retention:</strong> {{ cloudwatch_logs.log_groups_with_retention }}</li>
                <li><strong>Log Groups without Retention:</strong> {{ cloudwatch_logs.log_groups - cloudwatch_logs.log_groups_with_retention }}</li>
            </ul>

            <h3>RDS CloudWatch Logging</h3>
            <ul>
                <li><strong>Instances Analyzed:</strong> {{ rds_logging.instances }}</li>
                <li><strong>Instances with Logging:</strong> {{ rds_logging.instances_with_logging }}</li>
                <li><strong>Instances without Logging:</strong> {{ rds_logging.instances - rds_logging.instances_with_logging }}</li>
            </ul>
        </div>

        <div class="section">
            <h2>Detailed Findings</h2>
            <table class="findings-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Severity</th>
                        <th>Description</th>
                        <th>PCI Reference</th>
                    </tr>
                </thead>
                <tbody>
                    {% for issue in all_issues %}
                    <tr>
                        <td>{{ issue.category }}</td>
                        <td>
                            <span class="severity-{{ issue.severity.lower() }}">
                                {{ issue.severity }}
                            </span>
                        </td>
                        <td>{{ issue.description }}</td>
                        <td>{{ issue.pci_reference }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Recommendations</h2>
            <div class="recommendations-grid">
                {% for rec in recommendations %}
                <div class="recommendation-card priority-{{ rec.priority.lower() }}">
                    <h3>{{ rec.title }}</h3>
                    <p><strong>Priority:</strong> {{ rec.priority }}</p>
                    <p><strong>Category:</strong> {{ rec.category }}</p>
                    <p><strong>Description:</strong> {{ rec.description }}</p>
                    <p><strong>PCI Reference:</strong> {{ rec.pci_reference }}</p>
                    <p><strong>Estimated Cost:</strong> {{ rec.estimated_cost }}</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="section">
            <h2>PCI DSS Compliance Status</h2>
            <table class="compliance-table">
                <thead>
                    <tr>
                        <th>PCI Requirement</th>
                        <th>Description</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req, desc in pci_requirements.items() %}
                    <tr>
                        <td>{{ req }}</td>
                        <td>{{ desc }}</td>
                        <td>
                            <span class="status-{{ 'compliant' if req not in non_compliant_requirements else 'non-compliant' }}">
                                {{ 'Compliant' if req not in non_compliant_requirements else 'Non-Compliant' }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Cost Optimization Recommendations</h2>
            <div class="cost-optimization">
                <h3>Strategies to Minimize Log Management Costs</h3>
                <ul>
                    <li><strong>Log Filtering:</strong> Filter out non-essential logs to reduce storage costs</li>
                    <li><strong>Storage Tier Optimization:</strong> Use S3 lifecycle policies to transition logs to cheaper storage tiers</li>
                    <li><strong>Log Aggregation:</strong> Centralize logs to reduce duplication and storage costs</li>
                    <li><strong>Retention Optimization:</strong> Implement appropriate retention periods based on requirements</li>
                    <li><strong>CloudTrail Insights:</strong> Use CloudTrail Insights to reduce CloudTrail costs</li>
                </ul>
            </div>
        </div>

        {% if generate_scripts %}
        <div class="section">
            <h2>Remediation Scripts</h2>
            <div class="script-section">
                <h3>Generated Remediation Scripts</h3>
                <p>The following scripts have been generated to automatically apply the recommendations:</p>
                <ul class="script-list">
                    {% for script in generated_scripts %}
                    <li><strong>{{ script.name }}:</strong> {{ script.description }}</li>
                    {% endfor %}
                </ul>
                <p><strong>To apply all remediations:</strong> Run the master script: <code>./scripts/run_all_remediation.sh</code></p>
            </div>
        </div>
        {% endif %}

        <div class="section">
            <h2>Next Steps</h2>
            <ol>
                <li><strong>Review Findings:</strong> Carefully review all findings and recommendations</li>
                <li><strong>Prioritize Remediation:</strong> Address high-priority issues first</li>
                <li><strong>Test Scripts:</strong> Test remediation scripts in a non-production environment</li>
                <li><strong>Implement Changes:</strong> Apply recommended changes systematically</li>
                <li><strong>Validate Compliance:</strong> Re-run the analysis to verify compliance</li>
                <li><strong>Document Implementation:</strong> Document all changes for compliance purposes</li>
                <li><strong>Establish Monitoring:</strong> Set up ongoing monitoring and alerting</li>
                <li><strong>Regular Reviews:</strong> Schedule regular compliance reviews</li>
            </ol>
        </div>

        <div class="footer">
            <p>This report was generated by the AWS Log Management Review Tool</p>
            <p>For questions or support, please contact your AWS administrator or security team</p>
        </div>
    </div>
</body>
</html> 